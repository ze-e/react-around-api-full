{"ast":null,"code":"import _toConsumableArray from\"C:/Users/ZEE/Yandex/react-around-api-full/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/Users/ZEE/Yandex/react-around-api-full/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React from'react';import{Route,Switch,useHistory,Redirect}from'react-router-dom';//component\nimport Header from'./Header';import Main from'./Main';import Footer from'./Footer';import PopupWithImage from'./PopupWithImage';import EditProfilePopUp from'./EditProfilePopUp';import EditAvatarPopUp from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import DeletePopup from'./DeletePopup';//login\nimport Login from'./Login';import SignUp from'./SignUp';import{auth}from'../utils/auth';import ProtectedRoute from'./ProtectedRoute';import InfoTooltip from'./InfoTooltip';//context\nimport{CurrentUserContext}from'../contexts/CurrentUserContext';//util\nimport{api}from'../utils/api';import{formValidator}from'../utils/formvalidator';function App(){//history\nvar history=useHistory();//state\nvar _React$useState=React.useState({link:'#'}),_React$useState2=_slicedToArray(_React$useState,2),selectedCard=_React$useState2[0],setselectedCard=_React$useState2[1];var _React$useState3=React.useState({}),_React$useState4=_slicedToArray(_React$useState3,2),currentUser=_React$useState4[0],setcurrentUser=_React$useState4[1];var _React$useState5=React.useState([]),_React$useState6=_slicedToArray(_React$useState5,2),cards=_React$useState6[0],setCards=_React$useState6[1];var _React$useState7=React.useState(true),_React$useState8=_slicedToArray(_React$useState7,2),loading=_React$useState8[0],setLoading=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),loggedIn=_React$useState10[0],setloggedIn=_React$useState10[1];//isOpen props for popups\nvar _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isEditProfilePopupOpen=_React$useState12[0],setIsEditProfilePopupOpen=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isAddPlacePopupOpen=_React$useState14[0],setIsAddPlacePopupOpen=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isEditAvatarPopupOpen=_React$useState16[0],setisEditAvatarPopupOpen=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isDeletePopupOpen=_React$useState18[0],setisDeletePopupOpen=_React$useState18[1];var _React$useState19=React.useState(false),_React$useState20=_slicedToArray(_React$useState19,2),isCardOpen=_React$useState20[0],setisCardOpen=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),isToolTipOpen=_React$useState22[0],setisToolTipOpen=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),isSuccess=_React$useState24[0],setisSuccess=_React$useState24[1];//update user functions\nfunction handleUpdateUser(name,about){api.editProfile(name,about).then(function(data){setcurrentUser(data);}).catch(function(err){console.log(err);alert(err);}).finally(function(){closeAllPopups();});}function handleUpdateAvatar(link){api.editAvatar(link).then(function(data){setcurrentUser(data);}).catch(function(err){console.log(err);alert(err);}).finally(function(){closeAllPopups();});}//card functions\nfunction handleDeleteClick(card){setselectedCard(card);setisDeletePopupOpen(true);}function handleCardClick(card){setisCardOpen(true);setselectedCard(card);}function handleCardLike(card){// Check one more time if this card was already liked\n//const isLiked = card.likes.some(i => i._id === currentUser._id);\nvar isLiked=card.likes.some(function(i){return i===currentUser._id;});// Send a request to the API and getting the updated card data\napi.changeLikeCardStatus(card._id,isLiked).then(function(newCard){// Create a new array based on the existing one and putting a new card into it\nvar newCards=cards.map(function(c){return c._id===card._id?newCard:c;});// Update the state\nsetCards(newCards);}).catch(function(err){console.log(err);alert(err);}).finally(function(){closeAllPopups();});}function handleCardDelete(cardId){//delete the card\napi.deleteCard(cardId).then(function(){var newCards=cards.filter(function(c){return c._id!==cardId;});setCards(newCards);}).catch(function(err){console.log(err);alert(err);}).finally(function(){closeAllPopups();});}//popup functions\nfunction handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleEditAvatarClick(){setisEditAvatarPopupOpen(true);}function handleAddPlaceSubmit(name,link){api.addCard(name,link).then(function(newCard){setCards([].concat(_toConsumableArray(cards),[newCard]));}).catch(function(err){console.log(err);alert(err);}).finally(function(){closeAllPopups();});}//login functions\nfunction handleLogin(isLoggedIn){setloggedIn(isLoggedIn);if(!isLoggedIn){//delete token\nsetcurrentUser({});localStorage.removeItem('token');}}function handleDisplayInfoTooltip(success){setisSuccess(success);setisToolTipOpen(true);}function handleRegisterUser(email,password){auth.register(email,password).then(function(res){if(res){handleDisplayInfoTooltip(true);history.push(\"/login\");handleLogInUser(email,password);}else{handleDisplayInfoTooltip(false);}});}function handleLogInUser(email,password){auth.login(email,password).then(function(res){if(res){handleLogin(true);history.push(\"/\");}else{handleDisplayInfoTooltip(false);}});}//close and reset popups\nfunction closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setisEditAvatarPopupOpen(false);setisDeletePopupOpen(false);setisCardOpen(false);setisToolTipOpen(false);setselectedCard({link:'#'});}//click outside container \nfunction handleClickOutsideForm(e,selector){if(e.target.className.includes(selector)){closeAllPopups();}}//close window when escape is pressed\nvar handleKeyPress=React.useCallback(function(e){if(e.key==='Escape'){closeAllPopups();}},[]);//add Escape event\nReact.useEffect(function(){window.addEventListener('keydown',handleKeyPress);return function(){window.removeEventListener('keydown',handleKeyPress);};},[handleKeyPress]);//get user and initial cards\nReact.useEffect(function(){//get user from token\nif(localStorage.getItem('token')){var token=localStorage.getItem('token');api.setToken(token);setloggedIn(true);api.getUser().then(function(data){setcurrentUser(data);//get cards\napi.getCards().then(function(data){setCards(data);}).catch(function(err){console.log(err);});}).catch(function(err){console.log(err);});}//after loading everything, set loading to false\nsetLoading(false);},[currentUser,loggedIn]);return(//show loading message if user and cards are not loaded\nloading?/*#__PURE__*/_jsx(\"div\",{className:\"App page loading\",children:\"Loading page...\"}):/*#__PURE__*/_jsx(\"div\",{className:\"App page\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,login:handleLogin}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(SignUp,{formValidator:formValidator.formValidator,fieldValidator:formValidator.fieldValidator,registerUser:handleRegisterUser})}),/*#__PURE__*/_jsx(Route,{path:\"/login\",children:function children(){return!loggedIn?/*#__PURE__*/_jsx(Login,{formValidator:formValidator.formValidator,fieldValidator:formValidator.fieldValidator,logInUser:handleLogInUser}):/*#__PURE__*/ //redirect to main if already logged in\n_jsx(Redirect,{to:\"/\"});}}),/*#__PURE__*/_jsx(ProtectedRoute,{path:\"*\",loggedIn:loggedIn,component:Main,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,card:selectedCard,cards:cards,onCardLike:handleCardLike,onCardDelete:handleDeleteClick})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopUp,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,onOutsideClick:handleClickOutsideForm,formValidator:formValidator.formValidator,fieldValidator:formValidator.fieldValidator}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,onOutsideClick:handleClickOutsideForm,formValidator:formValidator.formValidator,fieldValidator:formValidator.fieldValidator}),/*#__PURE__*/_jsx(EditAvatarPopUp,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,onOutsideClick:handleClickOutsideForm,formValidator:formValidator.formValidator,fieldValidator:formValidator.fieldValidator}),/*#__PURE__*/_jsx(PopupWithImage,{card:selectedCard,isOpen:isCardOpen,onClose:closeAllPopups,onOutsideClick:handleClickOutsideForm}),/*#__PURE__*/_jsx(DeletePopup,{isOpen:isDeletePopupOpen,onClose:closeAllPopups,card:selectedCard,onDelete:handleCardDelete,onOutsideClick:handleClickOutsideForm}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isToolTipOpen,onClose:closeAllPopups,onOutsideClick:handleClickOutsideForm,success:isSuccess})]})}));}export default App;","map":{"version":3,"sources":["C:/Users/ZEE/Yandex/react-around-api-full/frontend/src/components/App.js"],"names":["React","Route","Switch","useHistory","Redirect","Header","Main","Footer","PopupWithImage","EditProfilePopUp","EditAvatarPopUp","AddPlacePopup","DeletePopup","Login","SignUp","auth","ProtectedRoute","InfoTooltip","CurrentUserContext","api","formValidator","App","history","useState","link","selectedCard","setselectedCard","currentUser","setcurrentUser","cards","setCards","loading","setLoading","loggedIn","setloggedIn","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setisEditAvatarPopupOpen","isDeletePopupOpen","setisDeletePopupOpen","isCardOpen","setisCardOpen","isToolTipOpen","setisToolTipOpen","isSuccess","setisSuccess","handleUpdateUser","name","about","editProfile","then","data","catch","err","console","log","alert","finally","closeAllPopups","handleUpdateAvatar","editAvatar","handleDeleteClick","card","handleCardClick","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","newCards","map","c","handleCardDelete","cardId","deleteCard","filter","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleAddPlaceSubmit","addCard","handleLogin","isLoggedIn","localStorage","removeItem","handleDisplayInfoTooltip","success","handleRegisterUser","email","password","register","res","push","handleLogInUser","login","handleClickOutsideForm","e","selector","target","className","includes","handleKeyPress","useCallback","key","useEffect","window","addEventListener","removeEventListener","getItem","token","setToken","getUser","getCards","fieldValidator"],"mappings":"gaAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,KAAT,CAAgBC,MAAhB,CAAwBC,UAAxB,CAAoCC,QAApC,KAAoD,kBAApD,CAEA;AACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,IAAP,KAAiB,QAAjB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oBAA7B,CACA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CAEA;AACA,MAAOC,CAAAA,KAAP,KAAkB,SAAlB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,OAAQC,IAAR,KAAmB,eAAnB,CACA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CAEA;AACA,OAAQC,kBAAR,KAAiC,gCAAjC,CACA;AACA,OAAQC,GAAR,KAAkB,cAAlB,CACA,OAAQC,aAAR,KAA4B,wBAA5B,CAEA,QAASC,CAAAA,GAAT,EAAe,CACb;AACA,GAAMC,CAAAA,OAAO,CAAGnB,UAAU,EAA1B,CAEA;AAJa,oBAK2BH,KAAK,CAACuB,QAAN,CAAe,CAACC,IAAI,CAAC,GAAN,CAAf,CAL3B,oDAKNC,YALM,qBAKQC,eALR,0CAMyB1B,KAAK,CAACuB,QAAN,CAAe,EAAf,CANzB,qDAMNI,WANM,qBAMOC,cANP,0CAOa5B,KAAK,CAACuB,QAAN,CAAe,EAAf,CAPb,qDAONM,KAPM,qBAOCC,QAPD,0CAQiB9B,KAAK,CAACuB,QAAN,CAAe,IAAf,CARjB,qDAQNQ,OARM,qBAQGC,UARH,0CASmBhC,KAAK,CAACuB,QAAN,CAAe,KAAf,CATnB,sDASNU,QATM,sBASIC,WATJ,sBAWb;AAXa,sBAY+ClC,KAAK,CAACuB,QAAN,CAAe,KAAf,CAZ/C,uDAYNY,sBAZM,sBAYkBC,yBAZlB,4CAayCpC,KAAK,CAACuB,QAAN,CAAe,KAAf,CAbzC,uDAaNc,mBAbM,sBAaeC,sBAbf,4CAc6CtC,KAAK,CAACuB,QAAN,CAAe,KAAf,CAd7C,uDAcNgB,qBAdM,sBAciBC,wBAdjB,4CAeqCxC,KAAK,CAACuB,QAAN,CAAe,KAAf,CAfrC,uDAeNkB,iBAfM,sBAeaC,oBAfb,4CAgBuB1C,KAAK,CAACuB,QAAN,CAAe,KAAf,CAhBvB,uDAgBNoB,UAhBM,sBAgBMC,aAhBN,4CAiB6B5C,KAAK,CAACuB,QAAN,CAAe,KAAf,CAjB7B,uDAiBNsB,aAjBM,sBAiBSC,gBAjBT,4CAkBqB9C,KAAK,CAACuB,QAAN,CAAe,KAAf,CAlBrB,uDAkBNwB,SAlBM,sBAkBKC,YAlBL,sBAoBb;AACA,QAASC,CAAAA,gBAAT,CAA0BC,IAA1B,CAAgCC,KAAhC,CAAsC,CACpChC,GAAG,CAACiC,WAAJ,CAAgBF,IAAhB,CAAsBC,KAAtB,EACCE,IADD,CACM,SAACC,IAAD,CAAQ,CACZ1B,cAAc,CAAC0B,IAAD,CAAd,CACD,CAHD,EAICC,KAJD,CAIO,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACAG,KAAK,CAACH,GAAD,CAAL,CACD,CAPD,EAQCI,OARD,CAQS,UAAI,CAACC,cAAc,GAAG,CAR/B,EASD,CAED,QAASC,CAAAA,kBAAT,CAA4BtC,IAA5B,CAAiC,CAC/BL,GAAG,CAAC4C,UAAJ,CAAevC,IAAf,EACC6B,IADD,CACM,SAACC,IAAD,CAAQ,CACZ1B,cAAc,CAAC0B,IAAD,CAAd,CACD,CAHD,EAICC,KAJD,CAIO,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACAG,KAAK,CAACH,GAAD,CAAL,CACD,CAPD,EAQCI,OARD,CAQS,UAAI,CAACC,cAAc,GAAG,CAR/B,EASD,CACD;AACA,QAASG,CAAAA,iBAAT,CAA2BC,IAA3B,CAAgC,CAC9BvC,eAAe,CAACuC,IAAD,CAAf,CACAvB,oBAAoB,CAAC,IAAD,CAApB,CACD,CAED,QAASwB,CAAAA,eAAT,CAAyBD,IAAzB,CAA8B,CAC5BrB,aAAa,CAAC,IAAD,CAAb,CACAlB,eAAe,CAACuC,IAAD,CAAf,CACD,CAED,QAASE,CAAAA,cAAT,CAAwBF,IAAxB,CAA8B,CAC5B;AACA;AACA,GAAMG,CAAAA,OAAO,CAAGH,IAAI,CAACI,KAAL,CAAWC,IAAX,CAAgB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,GAAK5C,WAAW,CAAC6C,GAAtB,EAAjB,CAAhB,CAEA;AACArD,GAAG,CAACsD,oBAAJ,CAAyBR,IAAI,CAACO,GAA9B,CAAmCJ,OAAnC,EAA4Cf,IAA5C,CAAiD,SAACqB,OAAD,CAAa,CAC1D;AACF,GAAMC,CAAAA,QAAQ,CAAG9C,KAAK,CAAC+C,GAAN,CAAU,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACL,GAAF,GAAUP,IAAI,CAACO,GAAf,CAAqBE,OAArB,CAA+BG,CAAtC,EAAV,CAAjB,CACA;AACA/C,QAAQ,CAAC6C,QAAD,CAAR,CACD,CALD,EAMCpB,KAND,CAMO,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACAG,KAAK,CAACH,GAAD,CAAL,CACD,CATD,EAUCI,OAVD,CAUS,UAAI,CAACC,cAAc,GAAG,CAV/B,EAWD,CAED,QAASiB,CAAAA,gBAAT,CAA0BC,MAA1B,CAAiC,CAC/B;AACA5D,GAAG,CAAC6D,UAAJ,CAAeD,MAAf,EACC1B,IADD,CACM,UAAM,CACV,GAAMsB,CAAAA,QAAQ,CAAG9C,KAAK,CAACoD,MAAN,CAAa,SAACJ,CAAD,CAAK,CACjC,MAAOA,CAAAA,CAAC,CAACL,GAAF,GAAUO,MAAjB,CACD,CAFgB,CAAjB,CAGAjD,QAAQ,CAAC6C,QAAD,CAAR,CACD,CAND,EAOCpB,KAPD,CAOO,SAACC,GAAD,CAAS,CACZC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACAG,KAAK,CAACH,GAAD,CAAL,CACD,CAVH,EAWCI,OAXD,CAWS,UAAI,CAACC,cAAc,GAAG,CAX/B,EAYD,CAED;AACA,QAASqB,CAAAA,sBAAT,EAAiC,CAC/B9C,yBAAyB,CAAC,IAAD,CAAzB,CACD,CAED,QAAS+C,CAAAA,mBAAT,EAA8B,CAC5B7C,sBAAsB,CAAC,IAAD,CAAtB,CACD,CAED,QAAS8C,CAAAA,qBAAT,EAAgC,CAC9B5C,wBAAwB,CAAC,IAAD,CAAxB,CACD,CAED,QAAS6C,CAAAA,oBAAT,CAA8BnC,IAA9B,CAAoC1B,IAApC,CAAyC,CACvCL,GAAG,CAACmE,OAAJ,CAAYpC,IAAZ,CAAiB1B,IAAjB,EAAuB6B,IAAvB,CAA4B,SAACqB,OAAD,CAAa,CACvC5C,QAAQ,8BAAKD,KAAL,GAAY6C,OAAZ,GAAR,CACD,CAFD,EAGCnB,KAHD,CAGO,SAACC,GAAD,CAAS,CACZC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACAG,KAAK,CAACH,GAAD,CAAL,CACD,CANH,EAOCI,OAPD,CAOS,UAAI,CAACC,cAAc,GAAG,CAP/B,EAQD,CAED;AACA,QAAS0B,CAAAA,WAAT,CAAqBC,UAArB,CAAgC,CAC9BtD,WAAW,CAACsD,UAAD,CAAX,CACA,GAAG,CAACA,UAAJ,CAAe,CACf;AACA5D,cAAc,CAAC,EAAD,CAAd,CACA6D,YAAY,CAACC,UAAb,CAAwB,OAAxB,EACC,CACF,CAED,QAASC,CAAAA,wBAAT,CAAkCC,OAAlC,CAA0C,CACxC5C,YAAY,CAAC4C,OAAD,CAAZ,CACA9C,gBAAgB,CAAC,IAAD,CAAhB,CACD,CAED,QAAS+C,CAAAA,kBAAT,CAA4BC,KAA5B,CAAmCC,QAAnC,CAA4C,CAC1ChF,IAAI,CAACiF,QAAL,CAAcF,KAAd,CAAqBC,QAArB,EACC1C,IADD,CACM,SAAC4C,GAAD,CAAS,CACb,GAAGA,GAAH,CAAO,CACLN,wBAAwB,CAAC,IAAD,CAAxB,CACArE,OAAO,CAAC4E,IAAR,CAAa,QAAb,EACAC,eAAe,CAACL,KAAD,CAAQC,QAAR,CAAf,CACD,CAJD,IAKI,CACFJ,wBAAwB,CAAC,KAAD,CAAxB,CACD,CACF,CAVD,EAWD,CAED,QAASQ,CAAAA,eAAT,CAAyBL,KAAzB,CAAgCC,QAAhC,CAAyC,CACvChF,IAAI,CAACqF,KAAL,CAAWN,KAAX,CAAkBC,QAAlB,EACC1C,IADD,CACM,SAAC4C,GAAD,CAAS,CACb,GAAGA,GAAH,CAAO,CACLV,WAAW,CAAC,IAAD,CAAX,CACAjE,OAAO,CAAC4E,IAAR,CAAa,GAAb,EACD,CAHD,IAII,CACFP,wBAAwB,CAAC,KAAD,CAAxB,CACD,CACF,CATD,EAUD,CAED;AACA,QAAS9B,CAAAA,cAAT,EAAyB,CACvBzB,yBAAyB,CAAC,KAAD,CAAzB,CACAE,sBAAsB,CAAC,KAAD,CAAtB,CACAE,wBAAwB,CAAC,KAAD,CAAxB,CACAE,oBAAoB,CAAC,KAAD,CAApB,CACAE,aAAa,CAAC,KAAD,CAAb,CACAE,gBAAgB,CAAC,KAAD,CAAhB,CACApB,eAAe,CAAC,CAACF,IAAI,CAAC,GAAN,CAAD,CAAf,CACD,CAED;AACA,QAAS6E,CAAAA,sBAAT,CAAgCC,CAAhC,CAAmCC,QAAnC,CAA4C,CAC1C,GAAGD,CAAC,CAACE,MAAF,CAASC,SAAT,CAAmBC,QAAnB,CAA4BH,QAA5B,CAAH,CAAyC,CACvC1C,cAAc,GACf,CACF,CAED;AACA,GAAM8C,CAAAA,cAAc,CAAG3G,KAAK,CAAC4G,WAAN,CAAkB,SAACN,CAAD,CAAO,CAC5C,GAAGA,CAAC,CAACO,GAAF,GAAU,QAAb,CAAsB,CACpBhD,cAAc,GACf,CACF,CAJoB,CAIlB,EAJkB,CAAvB,CAMF;AACA7D,KAAK,CAAC8G,SAAN,CAAgB,UAAM,CAClBC,MAAM,CAACC,gBAAP,CAAwB,SAAxB,CAAmCL,cAAnC,EACA,MAAO,WAAM,CACXI,MAAM,CAACE,mBAAP,CAA2B,SAA3B,CAAsCN,cAAtC,EACD,CAFD,CAGD,CALH,CAKK,CAACA,cAAD,CALL,EAOI;AACA3G,KAAK,CAAC8G,SAAN,CAAgB,UAAI,CAClB;AACA,GAAIrB,YAAY,CAACyB,OAAb,CAAqB,OAArB,CAAJ,CAAmC,CACjC,GAAMC,CAAAA,KAAK,CAAG1B,YAAY,CAACyB,OAAb,CAAqB,OAArB,CAAd,CACA/F,GAAG,CAACiG,QAAJ,CAAaD,KAAb,EACAjF,WAAW,CAAC,IAAD,CAAX,CACAf,GAAG,CAACkG,OAAJ,GACChE,IADD,CACM,SAACC,IAAD,CAAQ,CACZ1B,cAAc,CAAC0B,IAAD,CAAd,CACA;AACAnC,GAAG,CAACmG,QAAJ,GACCjE,IADD,CACM,SAACC,IAAD,CAAU,CACdxB,QAAQ,CAACwB,IAAD,CAAR,CACD,CAHD,EAICC,KAJD,CAIO,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAND,EAOD,CAXD,EAYCD,KAZD,CAYO,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAdD,EAeD,CACD;AACAxB,UAAU,CAAC,KAAD,CAAV,CACD,CAxBD,CAwBE,CAACL,WAAD,CAAcM,QAAd,CAxBF,EA0BF,MACE;AACFF,OAAO,cAAG,YAAK,SAAS,CAAC,kBAAf,6BAAH,cAET,YAAK,SAAS,CAAC,UAAf,uBACA,MAAC,kBAAD,CAAoB,QAApB,EAA6B,KAAK,CAAEJ,WAApC,wBACE,KAAC,MAAD,EAAQ,QAAQ,CAAEM,QAAlB,CAA4B,KAAK,CAAEsD,WAAnC,EADF,cAEE,MAAC,MAAD,yBACA,KAAC,KAAD,EAAO,IAAI,CAAC,SAAZ,uBACE,KAAC,MAAD,EACE,aAAa,CAAEnE,aAAa,CAACA,aAD/B,CAEE,cAAc,CAAEA,aAAa,CAACmG,cAFhC,CAGE,YAAY,CAAE1B,kBAHhB,EADF,EADA,cAQA,KAAC,KAAD,EAAO,IAAI,CAAC,QAAZ,UAEE,0BAAM,CAAC5D,QAAD,cACN,KAAC,KAAD,EACE,aAAa,CAAEb,aAAa,CAACA,aAD/B,CAEE,cAAc,CAAEA,aAAa,CAACmG,cAFhC,CAGE,SAAS,CAAEpB,eAHb,EADM,eAMN;AACA,KAAC,QAAD,EAAU,EAAE,CAAC,GAAb,EAPA,EAFF,EARA,cAoBA,KAAC,cAAD,EAAgB,IAAI,CAAC,GAArB,CACE,QAAQ,CAAElE,QADZ,CAEE,SAAS,CAAE3B,IAFb,CAGE,aAAa,CAAI4E,sBAHnB,CAIE,UAAU,CAAIC,mBAJhB,CAKE,YAAY,CAAIC,qBALlB,CAME,WAAW,CAAIlB,eANjB,CAOE,IAAI,CAAIzC,YAPV,CAQE,KAAK,CAAII,KARX,CASE,UAAU,CAAIsC,cAThB,CAUE,YAAY,CAAIH,iBAVlB,EApBA,GAFF,cAoCE,KAAC,MAAD,IApCF,cAqCE,KAAC,gBAAD,EACE,MAAM,CAAE7B,sBADV,CAEE,OAAO,CAAE0B,cAFX,CAGE,YAAY,CAAEZ,gBAHhB,CAIE,cAAc,CAAEoD,sBAJlB,CAKE,aAAa,CAAEjF,aAAa,CAACA,aAL/B,CAME,cAAc,CAAEA,aAAa,CAACmG,cANhC,EArCF,cA8CE,KAAC,aAAD,EACE,MAAM,CAAElF,mBADV,CAEE,OAAO,CAAEwB,cAFX,CAGE,UAAU,CAAEwB,oBAHd,CAIE,cAAc,CAAEgB,sBAJlB,CAKE,aAAa,CAAEjF,aAAa,CAACA,aAL/B,CAME,cAAc,CAAEA,aAAa,CAACmG,cANhC,EA9CF,cAuDE,KAAC,eAAD,EACE,MAAM,CAAEhF,qBADV,CAEE,OAAO,CAAEsB,cAFX,CAGE,cAAc,CAAEC,kBAHlB,CAIE,cAAc,CAAEuC,sBAJlB,CAKE,aAAa,CAAEjF,aAAa,CAACA,aAL/B,CAME,cAAc,CAAEA,aAAa,CAACmG,cANhC,EAvDF,cAgEE,KAAC,cAAD,EACE,IAAI,CAAE9F,YADR,CAEE,MAAM,CAAEkB,UAFV,CAGE,OAAO,CAAEkB,cAHX,CAIE,cAAc,CAAEwC,sBAJlB,EAhEF,cAuEE,KAAC,WAAD,EACE,MAAM,CAAE5D,iBADV,CAEE,OAAO,CAAEoB,cAFX,CAGE,IAAI,CAAIpC,YAHV,CAIE,QAAQ,CAAIqD,gBAJd,CAKE,cAAc,CAAEuB,sBALlB,EAvEF,cA+EE,KAAC,WAAD,EACE,MAAM,CAAExD,aADV,CAEE,OAAO,CAAEgB,cAFX,CAGE,cAAc,CAAEwC,sBAHlB,CAIE,OAAO,CAAEtD,SAJX,EA/EF,GADA,EAJE,EA4FA,CAEF,cAAe1B,CAAAA,GAAf","sourcesContent":["import React from 'react';\r\nimport { Route, Switch, useHistory, Redirect } from 'react-router-dom';\r\n\r\n//component\r\nimport Header from './Header';\r\nimport Main from './Main';\r\nimport Footer from './Footer';\r\nimport PopupWithImage from './PopupWithImage';\r\nimport EditProfilePopUp from './EditProfilePopUp';\r\nimport EditAvatarPopUp from './EditAvatarPopup';\r\nimport AddPlacePopup from './AddPlacePopup';\r\nimport DeletePopup from './DeletePopup';\r\n\r\n//login\r\nimport Login from './Login';\r\nimport SignUp from './SignUp';\r\nimport {auth} from '../utils/auth';\r\nimport ProtectedRoute from './ProtectedRoute'\r\nimport InfoTooltip from './InfoTooltip';\r\n\r\n//context\r\nimport {CurrentUserContext} from '../contexts/CurrentUserContext';\r\n//util\r\nimport {api} from '../utils/api';\r\nimport {formValidator} from '../utils/formvalidator'\r\n\r\nfunction App() {\r\n  //history\r\n  const history = useHistory();\r\n\r\n  //state\r\n  const [selectedCard, setselectedCard] = React.useState({link:'#'});\r\n  const [currentUser, setcurrentUser] = React.useState({});\r\n  const [cards, setCards] = React.useState([]);\r\n  const [loading, setLoading] = React.useState(true);\r\n  const [loggedIn, setloggedIn] = React.useState(false);\r\n\r\n  //isOpen props for popups\r\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\r\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\r\n  const [isEditAvatarPopupOpen, setisEditAvatarPopupOpen] = React.useState(false);\r\n  const [isDeletePopupOpen, setisDeletePopupOpen] = React.useState(false); \r\n  const [isCardOpen, setisCardOpen] = React.useState(false);\r\n  const [isToolTipOpen, setisToolTipOpen] = React.useState(false);\r\n  const [isSuccess, setisSuccess] = React.useState(false);\r\n\r\n  //update user functions\r\n  function handleUpdateUser(name, about){\r\n    api.editProfile(name, about)\r\n    .then((data)=>{\r\n      setcurrentUser(data);\r\n    })\r\n    .catch((err) => { \r\n      console.log(err);  \r\n      alert(err);\r\n    })\r\n    .finally(()=>{closeAllPopups()})\r\n  }\r\n\r\n  function handleUpdateAvatar(link){\r\n    api.editAvatar(link)\r\n    .then((data)=>{\r\n      setcurrentUser(data);\r\n    })\r\n    .catch((err) => { \r\n      console.log(err);\r\n      alert(err);\r\n    })\r\n    .finally(()=>{closeAllPopups()})\r\n  }\r\n  //card functions\r\n  function handleDeleteClick(card){\r\n    setselectedCard(card);\r\n    setisDeletePopupOpen(true);\r\n  }\r\n\r\n  function handleCardClick(card){\r\n    setisCardOpen(true);\r\n    setselectedCard(card);\r\n  }\r\n\r\n  function handleCardLike(card) {\r\n    // Check one more time if this card was already liked\r\n    //const isLiked = card.likes.some(i => i._id === currentUser._id);\r\n    const isLiked = card.likes.some(i => i === currentUser._id);\r\n    \r\n    // Send a request to the API and getting the updated card data\r\n    api.changeLikeCardStatus(card._id, isLiked).then((newCard) => {\r\n        // Create a new array based on the existing one and putting a new card into it\r\n      const newCards = cards.map((c) => c._id === card._id ? newCard : c);\r\n      // Update the state\r\n      setCards(newCards);\r\n    })\r\n    .catch((err) => { \r\n      console.log(err);\r\n      alert(err);\r\n    })\r\n    .finally(()=>{closeAllPopups()})\r\n  } \r\n\r\n  function handleCardDelete(cardId){\r\n    //delete the card\r\n    api.deleteCard(cardId)\r\n    .then(() => { \r\n      const newCards = cards.filter((c)=>{\r\n        return c._id !== cardId;\r\n      }); \r\n      setCards(newCards);\r\n    })\r\n    .catch((err) => { \r\n        console.log(err); \r\n        alert(err);\r\n      })\r\n    .finally(()=>{closeAllPopups()})\r\n  }\r\n  \r\n  //popup functions\r\n  function handleEditProfileClick(){\r\n    setIsEditProfilePopupOpen(true);\r\n  }\r\n\r\n  function handleAddPlaceClick(){\r\n    setIsAddPlacePopupOpen(true);\r\n  }\r\n\r\n  function handleEditAvatarClick(){\r\n    setisEditAvatarPopupOpen(true);\r\n  }\r\n\r\n  function handleAddPlaceSubmit(name, link){\r\n    api.addCard(name,link).then((newCard) => { \r\n      setCards([...cards, newCard]); \r\n    })\r\n    .catch((err) => { \r\n        console.log(err); \r\n        alert(err);\r\n      })\r\n    .finally(()=>{closeAllPopups()})\r\n  }\r\n\r\n  //login functions\r\n  function handleLogin(isLoggedIn){\r\n    setloggedIn(isLoggedIn);\r\n    if(!isLoggedIn){\r\n    //delete token\r\n    setcurrentUser({});\r\n    localStorage.removeItem('token');\r\n    }\r\n  }\r\n\r\n  function handleDisplayInfoTooltip(success){\r\n    setisSuccess(success);\r\n    setisToolTipOpen(true);\r\n  }\r\n\r\n  function handleRegisterUser(email, password){\r\n    auth.register(email, password)\r\n    .then((res) => {\r\n      if(res){\r\n        handleDisplayInfoTooltip(true);\r\n        history.push(\"/login\");\r\n        handleLogInUser(email, password);\r\n      }\r\n      else{\r\n        handleDisplayInfoTooltip(false);\r\n      }\r\n    })\r\n  }\r\n\r\n  function handleLogInUser(email, password){\r\n    auth.login(email, password)\r\n    .then((res) => {\r\n      if(res){\r\n        handleLogin(true);\r\n        history.push(\"/\");\r\n      }\r\n      else{\r\n        handleDisplayInfoTooltip(false);\r\n      }\r\n    })\r\n  }\r\n  \r\n  //close and reset popups\r\n  function closeAllPopups(){\r\n    setIsEditProfilePopupOpen(false);\r\n    setIsAddPlacePopupOpen(false);\r\n    setisEditAvatarPopupOpen(false);\r\n    setisDeletePopupOpen(false);\r\n    setisCardOpen(false);\r\n    setisToolTipOpen(false);\r\n    setselectedCard({link:'#'});\r\n  }\r\n  \r\n  //click outside container \r\n  function handleClickOutsideForm(e, selector){\r\n    if(e.target.className.includes(selector)){\r\n      closeAllPopups();\r\n    }\r\n  }\r\n\r\n  //close window when escape is pressed\r\n  const handleKeyPress = React.useCallback((e) => {\r\n      if(e.key === 'Escape'){ \r\n        closeAllPopups(); \r\n      } \r\n    }, []);\r\n\r\n//add Escape event\r\nReact.useEffect(() => {\r\n    window.addEventListener('keydown', handleKeyPress);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyPress);\r\n    };\r\n  }, [handleKeyPress]);\r\n\r\n    //get user and initial cards\r\n    React.useEffect(()=>{\r\n      //get user from token\r\n      if (localStorage.getItem('token')) {\r\n        const token = localStorage.getItem('token');\r\n        api.setToken(token);\r\n        setloggedIn(true);\r\n        api.getUser()\r\n        .then((data)=>{\r\n          setcurrentUser(data);\r\n          //get cards\r\n          api.getCards()\r\n          .then((data) => {  \r\n            setCards(data)\r\n          })\r\n          .catch((err) => { \r\n            console.log(err);\r\n          })\r\n        })\r\n        .catch((err) => { \r\n          console.log(err);\r\n        })\r\n      }\r\n      //after loading everything, set loading to false\r\n      setLoading(false);\r\n    },[currentUser, loggedIn])\r\n\r\n  return (\r\n    //show loading message if user and cards are not loaded\r\n  loading ? <div className=\"App page loading\">Loading page...</div> :\r\n\r\n<div className=\"App page\">\r\n<CurrentUserContext.Provider value={currentUser}>\r\n  <Header loggedIn={loggedIn} login={handleLogin}  />\r\n  <Switch>\r\n  <Route path=\"/signup\">\r\n    <SignUp\r\n      formValidator={formValidator.formValidator}\r\n      fieldValidator={formValidator.fieldValidator}\r\n      registerUser={handleRegisterUser}\r\n    />\r\n  </Route>\r\n  <Route path=\"/login\">\r\n  {\r\n    () => !loggedIn ?\r\n    <Login\r\n      formValidator={formValidator.formValidator}\r\n      fieldValidator={formValidator.fieldValidator}\r\n      logInUser={handleLogInUser}\r\n    /> : \r\n    //redirect to main if already logged in\r\n    <Redirect to='/' />\r\n  }\r\n  </Route>\r\n  <ProtectedRoute path=\"*\" \r\n    loggedIn={loggedIn} \r\n    component={Main}\r\n    onEditProfile = {handleEditProfileClick}\r\n    onAddPlace = {handleAddPlaceClick}\r\n    onEditAvatar = {handleEditAvatarClick}\r\n    onCardClick = {handleCardClick}\r\n    card = {selectedCard}\r\n    cards = {cards}\r\n    onCardLike = {handleCardLike}\r\n    onCardDelete = {handleDeleteClick}\r\n  >\r\n  </ProtectedRoute>\r\n  </Switch>\r\n  <Footer />\r\n  <EditProfilePopUp \r\n    isOpen={isEditProfilePopupOpen} \r\n    onClose={closeAllPopups}\r\n    onUpdateUser={handleUpdateUser}\r\n    onOutsideClick={handleClickOutsideForm}\r\n    formValidator={formValidator.formValidator}\r\n    fieldValidator={formValidator.fieldValidator}\r\n  />\r\n\r\n  <AddPlacePopup \r\n    isOpen={isAddPlacePopupOpen} \r\n    onClose={closeAllPopups}\r\n    onAddPlace={handleAddPlaceSubmit}\r\n    onOutsideClick={handleClickOutsideForm}\r\n    formValidator={formValidator.formValidator}\r\n    fieldValidator={formValidator.fieldValidator}\r\n    />\r\n\r\n  <EditAvatarPopUp \r\n    isOpen={isEditAvatarPopupOpen} \r\n    onClose={closeAllPopups}\r\n    onUpdateAvatar={handleUpdateAvatar}\r\n    onOutsideClick={handleClickOutsideForm}\r\n    formValidator={formValidator.formValidator}\r\n    fieldValidator={formValidator.fieldValidator}\r\n    />\r\n  \r\n  <PopupWithImage \r\n    card={selectedCard} \r\n    isOpen={isCardOpen}\r\n    onClose={closeAllPopups}\r\n    onOutsideClick={handleClickOutsideForm}\r\n    />\r\n\r\n  <DeletePopup \r\n    isOpen={isDeletePopupOpen} \r\n    onClose={closeAllPopups}\r\n    card = {selectedCard}\r\n    onDelete = {handleCardDelete}\r\n    onOutsideClick={handleClickOutsideForm}\r\n  /> \r\n\r\n  <InfoTooltip \r\n    isOpen={isToolTipOpen} \r\n    onClose={closeAllPopups}\r\n    onOutsideClick={handleClickOutsideForm}\r\n    success={isSuccess}\r\n  />\r\n</CurrentUserContext.Provider>\r\n</div>\r\n)}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}